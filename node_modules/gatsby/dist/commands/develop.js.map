{"version":3,"sources":["../../src/commands/develop.js"],"names":["url","require","glob","fs","openurl","chokidar","express","graphqlHTTP","graphqlPlayground","default","graphiqlExplorer","formatError","got","webpack","webpackConfig","bootstrap","store","emitter","syncStaticDir","buildHTML","withBasePath","report","launchEditor","formatWebpackMessages","chalk","address","cors","telemetry","WorkerPool","withResolverContext","sourceNodes","websocketManager","getSslCert","slash","initTracer","apiRunnerNode","db","detectPortInUseAndPrompt","onExit","queryUtil","queryWatcher","requiresWriter","reportWebpackWarnings","structureWebpackErrors","setTimeout","trackCli","waitJobsFinished","Promise","resolve","reject","onEndJob","getState","jobs","active","length","off","on","startServer","program","indexHTMLActivity","phantomActivity","start","directory","directoryPath","workerPool","create","createIndexHtml","activity","buildPages","stage","pagePaths","err","name","panic","stripIndent","end","webpackActivity","activityTimer","id","devConfig","port","parentSpan","span","compiler","app","use","expressMiddleware","log","path","heartbeat","graphqlEndpoint","process","env","GATSBY_GRAPHQL_IDE","get","endpoint","schema","schemaCustomization","graphiql","context","schemaComposer","composer","customContext","customFormatErrorFn","stack","split","REFRESH_ENDPOINT","json","post","req","res","enableRefresh","ENABLE_GATSBY_REFRESH_ENDPOINT","refreshToken","GATSBY_REFRESH_TOKEN","authorizedRefresh","headers","authorization","webhookBody","body","then","query","fileName","lineNumber","index","logLevel","publicPath","output","stats","developMiddleware","config","proxy","prefix","proxiedUrl","originalUrl","host","method","pipe","stream","decompress","response","writeHead","statusCode","_","message","error","sendStatus","status","next","sendFile","server","Server","ssl","createServer","init","socket","getSocket","listener","listen","code","watchGlobs","map","watch","to","emit","module","exports","openTracingConfigFile","pendingActivity","startBackgroundUpdate","parseInt","https","e","exit","sitePackageJson","replace","cwd","certFile","keyFile","graphqlRunner","initialProcessQueries","boundActionCreators","setProgramStatus","startListener","startAutosave","startListeningToDevelopQueue","startWatchDeletePage","prepareUrls","protocol","formatUrl","hostname","format","pathname","prettyPrintUrl","bold","isUnspecifiedHost","prettyHost","lanUrlForConfig","lanUrlForTerminal","ip","test","undefined","_e","localUrlForTerminal","localUrlForBrowser","printInstructions","appName","urls","useYarn","console","cyan","printDeprecationWarnings","deprecatedApis","fixMap","newName","docsLink","pathContext","deprecatedLocations","forEach","api","sync","nodir","file","fileText","readFileSync","matchingApis","filter","indexOf","push","yellow","hooks","watchRun","tapAsync","args","done","isFirstCompile","messages","toJson","isSuccessful","errors","open","catch","compilation","panicOnBuild"],"mappings":"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","sourcesContent":["/* @flow */\n\nconst url = require(`url`)\nconst glob = require(`glob`)\nconst fs = require(`fs`)\nconst openurl = require(`better-opn`)\nconst chokidar = require(`chokidar`)\nconst express = require(`express`)\nconst graphqlHTTP = require(`express-graphql`)\nconst graphqlPlayground = require(`graphql-playground-middleware-express`)\n  .default\nconst graphiqlExplorer = require(`gatsby-graphiql-explorer`)\nconst { formatError } = require(`graphql`)\nconst got = require(`got`)\nconst webpack = require(`webpack`)\nconst webpackConfig = require(`../utils/webpack.config`)\nconst bootstrap = require(`../bootstrap`)\nconst { store, emitter } = require(`../redux`)\nconst { syncStaticDir } = require(`../utils/get-static-dir`)\nconst buildHTML = require(`./build-html`)\nconst { withBasePath } = require(`../utils/path`)\nconst report = require(`gatsby-cli/lib/reporter`)\nconst launchEditor = require(`react-dev-utils/launchEditor`)\nconst formatWebpackMessages = require(`react-dev-utils/formatWebpackMessages`)\nconst chalk = require(`chalk`)\nconst address = require(`address`)\nconst cors = require(`cors`)\nconst telemetry = require(`gatsby-telemetry`)\nconst WorkerPool = require(`../utils/worker/pool`)\n\nconst withResolverContext = require(`../schema/context`)\nconst sourceNodes = require(`../utils/source-nodes`)\nconst websocketManager = require(`../utils/websocket-manager`)\nconst getSslCert = require(`../utils/get-ssl-cert`)\nconst slash = require(`slash`)\nconst { initTracer } = require(`../utils/tracer`)\nconst apiRunnerNode = require(`../utils/api-runner-node`)\nconst db = require(`../db`)\nconst detectPortInUseAndPrompt = require(`../utils/detect-port-in-use-and-prompt`)\nconst onExit = require(`signal-exit`)\nconst queryUtil = require(`../query`)\nconst queryWatcher = require(`../query/query-watcher`)\nconst requiresWriter = require(`../bootstrap/requires-writer`)\nconst {\n  reportWebpackWarnings,\n  structureWebpackErrors,\n} = require(`../utils/webpack-error-utils`)\n\n// const isInteractive = process.stdout.isTTY\n\n// Watch the static directory and copy files to public as they're added or\n// changed. Wait 10 seconds so copying doesn't interfere with the regular\n// bootstrap.\nsetTimeout(() => {\n  syncStaticDir()\n}, 10000)\n\nonExit(() => {\n  telemetry.trackCli(`DEVELOP_STOP`)\n})\n\nconst waitJobsFinished = () =>\n  new Promise((resolve, reject) => {\n    const onEndJob = () => {\n      if (store.getState().jobs.active.length === 0) {\n        resolve()\n        emitter.off(`END_JOB`, onEndJob)\n      }\n    }\n    emitter.on(`END_JOB`, onEndJob)\n    onEndJob()\n  })\n\nasync function startServer(program) {\n  const indexHTMLActivity = report.phantomActivity(`building index.html`, {})\n  indexHTMLActivity.start()\n  const directory = program.directory\n  const directoryPath = withBasePath(directory)\n  const workerPool = WorkerPool.create()\n  const createIndexHtml = async ({ activity }) => {\n    try {\n      await buildHTML.buildPages({\n        program,\n        stage: `develop-html`,\n        pagePaths: [`/`],\n        workerPool,\n        activity,\n      })\n    } catch (err) {\n      if (err.name !== `WebpackError`) {\n        report.panic(err)\n        return\n      }\n      report.panic(\n        report.stripIndent`\n          There was an error compiling the html.js component for the development server.\n\n          See our docs page on debugging HTML builds for help https://gatsby.dev/debug-html\n        `,\n        err\n      )\n    }\n  }\n\n  await createIndexHtml({ activity: indexHTMLActivity })\n\n  indexHTMLActivity.end()\n\n  // report.stateUpdate(`webpack`, `IN_PROGRESS`)\n\n  const webpackActivity = report.activityTimer(`Building development bundle`, {\n    id: `webpack-develop`,\n  })\n  webpackActivity.start()\n\n  const devConfig = await webpackConfig(\n    program,\n    directory,\n    `develop`,\n    program.port,\n    { parentSpan: webpackActivity.span }\n  )\n\n  const compiler = webpack(devConfig)\n\n  /**\n   * Set up the express app.\n   **/\n  const app = express()\n  app.use(telemetry.expressMiddleware(`DEVELOP`))\n  app.use(\n    require(`webpack-hot-middleware`)(compiler, {\n      log: false,\n      path: `/__webpack_hmr`,\n      heartbeat: 10 * 1000,\n    })\n  )\n\n  app.use(cors())\n\n  /**\n   * Pattern matching all endpoints with graphql or graphiql with 1 or more leading underscores\n   */\n  const graphqlEndpoint = `/_+graphi?ql`\n\n  if (process.env.GATSBY_GRAPHQL_IDE === `playground`) {\n    app.get(\n      graphqlEndpoint,\n      graphqlPlayground({\n        endpoint: `/___graphql`,\n      }),\n      () => {}\n    )\n  } else {\n    graphiqlExplorer(app, {\n      graphqlEndpoint,\n    })\n  }\n\n  app.use(\n    graphqlEndpoint,\n    graphqlHTTP(() => {\n      const { schema, schemaCustomization } = store.getState()\n\n      return {\n        schema,\n        graphiql: false,\n        context: withResolverContext({\n          schema,\n          schemaComposer: schemaCustomization.composer,\n          context: {},\n          customContext: schemaCustomization.context,\n        }),\n        customFormatErrorFn(err) {\n          return {\n            ...formatError(err),\n            stack: err.stack ? err.stack.split(`\\n`) : [],\n          }\n        },\n      }\n    })\n  )\n\n  /**\n   * Refresh external data sources.\n   * This behavior is disabled by default, but the ENABLE_REFRESH_ENDPOINT env var enables it\n   * If no GATSBY_REFRESH_TOKEN env var is available, then no Authorization header is required\n   **/\n  const REFRESH_ENDPOINT = `/__refresh`\n  app.use(REFRESH_ENDPOINT, express.json())\n  app.post(REFRESH_ENDPOINT, (req, res) => {\n    const enableRefresh = process.env.ENABLE_GATSBY_REFRESH_ENDPOINT\n    const refreshToken = process.env.GATSBY_REFRESH_TOKEN\n    const authorizedRefresh =\n      !refreshToken || req.headers.authorization === refreshToken\n\n    if (enableRefresh && authorizedRefresh) {\n      const activity = report.activityTimer(`Refreshing source data`, {})\n      activity.start()\n      sourceNodes({\n        webhookBody: req.body,\n      }).then(() => {\n        activity.end()\n      })\n    }\n    res.end()\n  })\n\n  app.get(`/__open-stack-frame-in-editor`, (req, res) => {\n    launchEditor(req.query.fileName, req.query.lineNumber)\n    res.end()\n  })\n\n  // Disable directory indexing i.e. serving index.html from a directory.\n  // This can lead to serving stale html files during development.\n  //\n  // We serve by default an empty index.html that sets up the dev environment.\n  app.use(require(`./develop-static`)(`public`, { index: false }))\n\n  app.use(\n    require(`webpack-dev-middleware`)(compiler, {\n      logLevel: `silent`,\n      publicPath: devConfig.output.publicPath,\n      stats: `errors-only`,\n    })\n  )\n\n  // Expose access to app for advanced use cases\n  const { developMiddleware } = store.getState().config\n\n  if (developMiddleware) {\n    developMiddleware(app, program)\n  }\n\n  // Set up API proxy.\n  const { proxy } = store.getState().config\n  if (proxy) {\n    const { prefix, url } = proxy\n    app.use(`${prefix}/*`, (req, res) => {\n      const proxiedUrl = url + req.originalUrl\n      const {\n        // remove `host` from copied headers\n        // eslint-disable-next-line no-unused-vars\n        headers: { host, ...headers },\n        method,\n      } = req\n      req\n        .pipe(\n          got\n            .stream(proxiedUrl, { headers, method, decompress: false })\n            .on(`response`, response =>\n              res.writeHead(response.statusCode, response.headers)\n            )\n            .on(`error`, (err, _, response) => {\n              if (response) {\n                res.writeHead(response.statusCode, response.headers)\n              } else {\n                const message = `Error when trying to proxy request \"${req.originalUrl}\" to \"${proxiedUrl}\"`\n\n                report.error(message, err)\n                res.sendStatus(500)\n              }\n            })\n        )\n        .pipe(res)\n    })\n  }\n\n  await apiRunnerNode(`onCreateDevServer`, { app })\n\n  // In case nothing before handled hot-update - send 404.\n  // This fixes \"Unexpected token < in JSON at position 0\" runtime\n  // errors after restarting development server and\n  // cause automatic hard refresh in the browser.\n  app.use(/.*\\.hot-update\\.json$/i, (req, res) => {\n    res.status(404).end()\n  })\n\n  // Render an HTML page and serve it.\n  app.use((req, res, next) => {\n    res.sendFile(directoryPath(`public/index.html`), err => {\n      if (err) {\n        res.status(500).end()\n      }\n    })\n  })\n\n  /**\n   * Set up the HTTP server and socket.io.\n   **/\n  let server = require(`http`).Server(app)\n\n  // If a SSL cert exists in program, use it with `createServer`.\n  if (program.ssl) {\n    server = require(`https`).createServer(program.ssl, app)\n  }\n  websocketManager.init({ server, directory: program.directory })\n  const socket = websocketManager.getSocket()\n\n  const listener = server.listen(program.port, program.host, err => {\n    if (err) {\n      if (err.code === `EADDRINUSE`) {\n        // eslint-disable-next-line max-len\n        report.panic(\n          `Unable to start Gatsby on port ${program.port} as there's already a process listening on that port.`\n        )\n        return\n      }\n\n      report.panic(`There was a problem starting the development server`, err)\n    }\n  })\n\n  // Register watcher that rebuilds index.html every time html.js changes.\n  const watchGlobs = [`src/html.js`, `plugins/**/gatsby-ssr.js`].map(path =>\n    slash(directoryPath(path))\n  )\n\n  chokidar.watch(watchGlobs).on(`change`, async () => {\n    await createIndexHtml({ activity: indexHTMLActivity })\n    socket.to(`clients`).emit(`reload`)\n  })\n\n  return { compiler, listener, webpackActivity }\n}\n\nmodule.exports = async (program: any) => {\n  initTracer(program.openTracingConfigFile)\n  report.pendingActivity({ id: `webpack-develop` })\n  telemetry.trackCli(`DEVELOP_START`)\n  telemetry.startBackgroundUpdate()\n\n  const port =\n    typeof program.port === `string` ? parseInt(program.port, 10) : program.port\n\n  // In order to enable custom ssl, --cert-file --key-file and -https flags must all be\n  // used together\n  if ((program[`cert-file`] || program[`key-file`]) && !program.https) {\n    report.panic(\n      `for custom ssl --https, --cert-file, and --key-file must be used together`\n    )\n  }\n\n  try {\n    program.port = await detectPortInUseAndPrompt(port)\n  } catch (e) {\n    if (e.message === `USER_REJECTED`) {\n      process.exit(0)\n    }\n\n    throw e\n  }\n\n  // Check if https is enabled, then create or get SSL cert.\n  // Certs are named after `name` inside the project's package.json.\n  // Scoped names are converted from @npm/package-name to npm--package-name.\n  // If the name is unavailable, generate one using the current working dir.\n  if (program.https) {\n    const name = program.sitePackageJson.name\n      ? program.sitePackageJson.name.replace(`@`, ``).replace(`/`, `--`)\n      : process.cwd().replace(/[^A-Za-z0-9]/g, `-`)\n\n    program.ssl = await getSslCert({\n      name,\n      certFile: program[`cert-file`],\n      keyFile: program[`key-file`],\n      directory: program.directory,\n    })\n  }\n\n  // Start bootstrap process.\n  const { graphqlRunner } = await bootstrap(program)\n\n  // Start the createPages hot reloader.\n  require(`../bootstrap/page-hot-reloader`)(graphqlRunner)\n\n  await queryUtil.initialProcessQueries()\n\n  require(`../redux/actions`).boundActionCreators.setProgramStatus(\n    `BOOTSTRAP_QUERY_RUNNING_FINISHED`\n  )\n\n  await waitJobsFinished()\n  requiresWriter.startListener()\n  db.startAutosave()\n  queryUtil.startListeningToDevelopQueue()\n  queryWatcher.startWatchDeletePage()\n\n  let { compiler, webpackActivity } = await startServer(program)\n\n  function prepareUrls(protocol, host, port) {\n    const formatUrl = hostname =>\n      url.format({\n        protocol,\n        hostname,\n        port,\n        pathname: `/`,\n      })\n    const prettyPrintUrl = hostname =>\n      url.format({\n        protocol,\n        hostname,\n        port: chalk.bold(port),\n        pathname: `/`,\n      })\n\n    const isUnspecifiedHost = host === `0.0.0.0` || host === `::`\n    let prettyHost = host,\n      lanUrlForConfig,\n      lanUrlForTerminal\n    if (isUnspecifiedHost) {\n      prettyHost = `localhost`\n\n      try {\n        // This can only return an IPv4 address\n        lanUrlForConfig = address.ip()\n        if (lanUrlForConfig) {\n          // Check if the address is a private ip\n          // https://en.wikipedia.org/wiki/Private_network#Private_IPv4_address_spaces\n          if (\n            /^10[.]|^172[.](1[6-9]|2[0-9]|3[0-1])[.]|^192[.]168[.]/.test(\n              lanUrlForConfig\n            )\n          ) {\n            // Address is private, format it for later use\n            lanUrlForTerminal = prettyPrintUrl(lanUrlForConfig)\n          } else {\n            // Address is not private, so we will discard it\n            lanUrlForConfig = undefined\n          }\n        }\n      } catch (_e) {\n        // ignored\n      }\n    }\n    // TODO collect errors (GraphQL + Webpack) in Redux so we\n    // can clear terminal and print them out on every compile.\n    // Borrow pretty printing code from webpack plugin.\n    const localUrlForTerminal = prettyPrintUrl(prettyHost)\n    const localUrlForBrowser = formatUrl(prettyHost)\n    return {\n      lanUrlForConfig,\n      lanUrlForTerminal,\n      localUrlForTerminal,\n      localUrlForBrowser,\n    }\n  }\n\n  function printInstructions(appName, urls, useYarn) {\n    console.log()\n    console.log(`You can now view ${chalk.bold(appName)} in the browser.`)\n    console.log()\n\n    if (urls.lanUrlForTerminal) {\n      console.log(\n        `  ${chalk.bold(`Local:`)}            ${urls.localUrlForTerminal}`\n      )\n      console.log(\n        `  ${chalk.bold(`On Your Network:`)}  ${urls.lanUrlForTerminal}`\n      )\n    } else {\n      console.log(`  ${urls.localUrlForTerminal}`)\n    }\n\n    console.log()\n    console.log(\n      `View ${\n        process.env.GATSBY_GRAPHQL_IDE === `playground`\n          ? `the GraphQL Playground`\n          : `GraphiQL`\n      }, an in-browser IDE, to explore your site's data and schema`\n    )\n    console.log()\n\n    if (urls.lanUrlForTerminal) {\n      console.log(\n        `  ${chalk.bold(`Local:`)}            ${\n          urls.localUrlForTerminal\n        }___graphql`\n      )\n      console.log(\n        `  ${chalk.bold(`On Your Network:`)}  ${\n          urls.lanUrlForTerminal\n        }___graphql`\n      )\n    } else {\n      console.log(`  ${urls.localUrlForTerminal}___graphql`)\n    }\n\n    console.log()\n    console.log(`Note that the development build is not optimized.`)\n    console.log(\n      `To create a production build, use ` + `${chalk.cyan(`gatsby build`)}`\n    )\n    console.log()\n  }\n\n  function printDeprecationWarnings() {\n    const deprecatedApis = [`boundActionCreators`, `pathContext`]\n    const fixMap = {\n      boundActionCreators: {\n        newName: `actions`,\n        docsLink: `https://gatsby.dev/boundActionCreators`,\n      },\n      pathContext: {\n        newName: `pageContext`,\n        docsLink: `https://gatsby.dev/pathContext`,\n      },\n    }\n    const deprecatedLocations = {}\n    deprecatedApis.forEach(api => (deprecatedLocations[api] = []))\n\n    glob\n      .sync(`{,!(node_modules|public)/**/}*.js`, { nodir: true })\n      .forEach(file => {\n        const fileText = fs.readFileSync(file)\n        const matchingApis = deprecatedApis.filter(\n          api => fileText.indexOf(api) !== -1\n        )\n        matchingApis.forEach(api => deprecatedLocations[api].push(file))\n      })\n\n    deprecatedApis.forEach(api => {\n      if (deprecatedLocations[api].length) {\n        console.log(\n          `%s %s %s %s`,\n          chalk.cyan(api),\n          chalk.yellow(`is deprecated. Please use`),\n          chalk.cyan(fixMap[api].newName),\n          chalk.yellow(\n            `instead. For migration instructions, see ${fixMap[api].docsLink}\\nCheck the following files:`\n          )\n        )\n        console.log()\n        deprecatedLocations[api].forEach(file => console.log(file))\n        console.log()\n      }\n    })\n  }\n\n  // compiler.hooks.invalid.tap(`log compiling`, function(...args) {\n  //   console.log(`set invalid`, args, this)\n  // })\n\n  compiler.hooks.watchRun.tapAsync(`log compiling`, function(args, done) {\n    if (webpackActivity) {\n      webpackActivity.end()\n    }\n    webpackActivity = report.activityTimer(`Re-building development bundle`, {\n      id: `webpack-develop`,\n    })\n    webpackActivity.start()\n\n    done()\n  })\n\n  let isFirstCompile = true\n  // \"done\" event fires when Webpack has finished recompiling the bundle.\n  // Whether or not you have warnings or errors, you will get this event.\n  compiler.hooks.done.tapAsync(`print gatsby instructions`, function(\n    stats,\n    done\n  ) {\n    // We have switched off the default Webpack output in WebpackDevServer\n    // options so we are going to \"massage\" the warnings and errors and present\n    // them in a readable focused way.\n    const messages = formatWebpackMessages(stats.toJson({}, true))\n    const urls = prepareUrls(\n      program.ssl ? `https` : `http`,\n      program.host,\n      program.port\n    )\n    const isSuccessful = !messages.errors.length\n\n    if (isSuccessful && isFirstCompile) {\n      printInstructions(program.sitePackageJson.name, urls, program.useYarn)\n      printDeprecationWarnings()\n      if (program.open) {\n        Promise.resolve(openurl(urls.localUrlForBrowser)).catch(err =>\n          console.log(\n            `${chalk.yellow(\n              `warn`\n            )} Browser not opened because no browser was found`\n          )\n        )\n      }\n    }\n\n    isFirstCompile = false\n\n    if (webpackActivity) {\n      reportWebpackWarnings(stats)\n\n      if (!isSuccessful) {\n        const errors = structureWebpackErrors(\n          `develop`,\n          stats.compilation.errors\n        )\n        webpackActivity.panicOnBuild(errors)\n      }\n      webpackActivity.end()\n      webpackActivity = null\n    }\n\n    done()\n  })\n}\n"],"file":"develop.js"}
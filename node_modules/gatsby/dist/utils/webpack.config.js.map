{"version":3,"sources":["../../src/utils/webpack.config.js"],"names":["require","fs","path","dotenv","FriendlyErrorsWebpackPlugin","PnpWebpackPlugin","store","actions","getPublicPath","debug","report","withBasePath","withTrailingSlash","apiRunnerNode","createUtils","hasLocalEslint","module","exports","program","directory","suppliedStage","directoryPath","process","env","GATSBY_BUILD_STAGE","stage","rules","loaders","plugins","getState","config","assetPrefix","pathPrefix","publicPath","processEnv","defaultNodeEnv","nodeEnv","NODE_ENV","configEnv","GATSBY_ACTIVE_ENV","envFile","join","cwd","parsed","parse","readFileSync","encoding","err","code","error","envObject","Object","keys","reduce","acc","key","JSON","stringify","gatsbyVarObject","match","PUBLIC_DIR","BUILD_STAGE","CYPRESS_SUPPORT","mergedEnvVars","assign","getHmrPath","hmrBasePath","hmrSuffix","GATSBY_WEBPACK_PUBLICPATH","pubPath","substr","getOutput","filename","pathinfo","devtoolModuleFilenameTemplate","info","resolve","absoluteResourcePath","replace","crossOriginLoading","libraryTarget","library","umdNamedDefine","globalObject","chunkFilename","Error","getEntry","commons","main","app","getPlugins","configPlugins","moment","define","__BASE_PATH__","prefixPaths","__PATH_PREFIX__","__ASSET_PREFIX__","concat","hotModuleReplacement","noEmitOnErrors","clearConsole","extractText","extractStats","getDevtool","getMode","getModule","configRules","mjs","js","yaml","fonts","images","media","miscAssets","themes","map","theme","test","include","themeDir","use","schema","eslint","oneOf","cssModules","css","push","loader","null","getResolve","extensions","alias","gatsby$","dirname","bind","getResolveLoader","root","userLoaderDirectoryPath","statSync","isDirectory","modules","__dirname","moduleLoader","context","entry","output","target","devtool","performance","hints","mode","resolveLoader","node","__filename","optimization","runtimeChunk","name","splitChunks","cacheGroups","styles","chunks","enforce","minimizer","noUglify","minifyJs","minifyCss","filter","Boolean","externalList","userExternalList","checkItem","item","request","RegExp","isExternal","some","externals","callback","external","dispatch","replaceWebpackConfig","getConfig","webpack"],"mappings":"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","sourcesContent":["require(`v8-compile-cache`)\n\nconst fs = require(`fs-extra`)\nconst path = require(`path`)\nconst dotenv = require(`dotenv`)\nconst FriendlyErrorsWebpackPlugin = require(`@pieh/friendly-errors-webpack-plugin`)\nconst PnpWebpackPlugin = require(`pnp-webpack-plugin`)\nconst { store } = require(`../redux`)\nconst { actions } = require(`../redux/actions`)\nconst getPublicPath = require(`./get-public-path`)\nconst debug = require(`debug`)(`gatsby:webpack-config`)\nconst report = require(`gatsby-cli/lib/reporter`)\nconst { withBasePath, withTrailingSlash } = require(`./path`)\n\nconst apiRunnerNode = require(`./api-runner-node`)\nconst createUtils = require(`./webpack-utils`)\nconst hasLocalEslint = require(`./local-eslint-config-finder`)\n\n// Four stages or modes:\n//   1) develop: for `gatsby develop` command, hot reload and CSS injection into page\n//   2) develop-html: same as develop without react-hmre in the babel config for html renderer\n//   3) build-javascript: Build JS and CSS chunks for production\n//   4) build-html: build all HTML files\n\nmodule.exports = async (program, directory, suppliedStage) => {\n  const directoryPath = withBasePath(directory)\n\n  process.env.GATSBY_BUILD_STAGE = suppliedStage\n\n  // We combine develop & develop-html stages for purposes of generating the\n  // webpack config.\n  const stage = suppliedStage\n  const { rules, loaders, plugins } = await createUtils({ stage, program })\n\n  const { assetPrefix, pathPrefix } = store.getState().config\n\n  const publicPath = getPublicPath({ assetPrefix, pathPrefix, ...program })\n\n  function processEnv(stage, defaultNodeEnv) {\n    debug(`Building env for \"${stage}\"`)\n    // node env should be DEVELOPMENT | PRODUCTION as these are commonly used in node land\n    // this variable is used inside webpack\n    const nodeEnv = process.env.NODE_ENV || `${defaultNodeEnv}`\n    // config env is depednant on the env that it's run, this can be anything from staging-production\n    // this allows you to set use different .env environments or conditions in gatsby files\n    const configEnv = process.env.GATSBY_ACTIVE_ENV || nodeEnv\n    const envFile = path.join(process.cwd(), `./.env.${configEnv}`)\n    let parsed = {}\n    try {\n      parsed = dotenv.parse(fs.readFileSync(envFile, { encoding: `utf8` }))\n    } catch (err) {\n      if (err.code !== `ENOENT`) {\n        report.error(\n          `There was a problem processing the .env file (${envFile})`,\n          err\n        )\n      }\n    }\n\n    const envObject = Object.keys(parsed).reduce((acc, key) => {\n      acc[key] = JSON.stringify(parsed[key])\n      return acc\n    }, {})\n\n    const gatsbyVarObject = Object.keys(process.env).reduce((acc, key) => {\n      if (key.match(/^GATSBY_/)) {\n        acc[key] = JSON.stringify(process.env[key])\n      }\n      return acc\n    }, {})\n\n    // Don't allow overwriting of NODE_ENV, PUBLIC_DIR as to not break gatsby things\n    envObject.NODE_ENV = JSON.stringify(nodeEnv)\n    envObject.PUBLIC_DIR = JSON.stringify(`${process.cwd()}/public`)\n    envObject.BUILD_STAGE = JSON.stringify(stage)\n    envObject.CYPRESS_SUPPORT = JSON.stringify(process.env.CYPRESS_SUPPORT)\n\n    const mergedEnvVars = Object.assign(envObject, gatsbyVarObject)\n\n    return Object.keys(mergedEnvVars).reduce(\n      (acc, key) => {\n        acc[`process.env.${key}`] = mergedEnvVars[key]\n        return acc\n      },\n      {\n        \"process.env\": JSON.stringify({}),\n      }\n    )\n  }\n\n  function getHmrPath() {\n    // ref: https://github.com/gatsbyjs/gatsby/issues/8348\n    let hmrBasePath = `/`\n    const hmrSuffix = `__webpack_hmr&reload=true&overlay=false`\n\n    if (process.env.GATSBY_WEBPACK_PUBLICPATH) {\n      const pubPath = process.env.GATSBY_WEBPACK_PUBLICPATH\n      if (pubPath.substr(-1) === `/`) {\n        hmrBasePath = pubPath\n      } else {\n        hmrBasePath = withTrailingSlash(pubPath)\n      }\n    }\n\n    return hmrBasePath + hmrSuffix\n  }\n\n  debug(`Loading webpack config for stage \"${stage}\"`)\n  function getOutput() {\n    switch (stage) {\n      case `develop`:\n        return {\n          path: directory,\n          filename: `[name].js`,\n          // Add /* filename */ comments to generated require()s in the output.\n          pathinfo: true,\n          // Point sourcemap entries to original disk location (format as URL on Windows)\n          publicPath: process.env.GATSBY_WEBPACK_PUBLICPATH || `/`,\n          devtoolModuleFilenameTemplate: info =>\n            path.resolve(info.absoluteResourcePath).replace(/\\\\/g, `/`),\n          // Avoid React cross-origin errors\n          // See https://reactjs.org/docs/cross-origin-errors.html\n          crossOriginLoading: `anonymous`,\n        }\n      case `build-html`:\n      case `develop-html`:\n        // A temp file required by static-site-generator-plugin. See plugins() below.\n        // Deleted by build-html.js, since it's not needed for production.\n        return {\n          path: directoryPath(`public`),\n          filename: `render-page.js`,\n          libraryTarget: `umd`,\n          library: `lib`,\n          umdNamedDefine: true,\n          globalObject: `this`,\n          publicPath: withTrailingSlash(publicPath),\n        }\n      case `build-javascript`:\n        return {\n          filename: `[name]-[contenthash].js`,\n          chunkFilename: `[name]-[contenthash].js`,\n          path: directoryPath(`public`),\n          publicPath: withTrailingSlash(publicPath),\n        }\n      default:\n        throw new Error(`The state requested ${stage} doesn't exist.`)\n    }\n  }\n\n  function getEntry() {\n    switch (stage) {\n      case `develop`:\n        return {\n          commons: [\n            require.resolve(`event-source-polyfill`),\n            `${require.resolve(\n              `webpack-hot-middleware/client`\n            )}?path=${getHmrPath()}`,\n            directoryPath(`.cache/app`),\n          ],\n        }\n      case `develop-html`:\n        return {\n          main: directoryPath(`.cache/develop-static-entry`),\n        }\n      case `build-html`:\n        return {\n          main: directoryPath(`.cache/static-entry`),\n        }\n      case `build-javascript`:\n        return {\n          app: directoryPath(`.cache/production-app`),\n        }\n      default:\n        throw new Error(`The state requested ${stage} doesn't exist.`)\n    }\n  }\n\n  function getPlugins() {\n    let configPlugins = [\n      plugins.moment(),\n\n      // Add a few global variables. Set NODE_ENV to production (enables\n      // optimizations for React) and what the link prefix is (__PATH_PREFIX__).\n      plugins.define({\n        ...processEnv(stage, `development`),\n        __BASE_PATH__: JSON.stringify(program.prefixPaths ? pathPrefix : ``),\n        __PATH_PREFIX__: JSON.stringify(program.prefixPaths ? publicPath : ``),\n        __ASSET_PREFIX__: JSON.stringify(\n          program.prefixPaths ? assetPrefix : ``\n        ),\n      }),\n    ]\n\n    switch (stage) {\n      case `develop`:\n        configPlugins = configPlugins.concat([\n          plugins.hotModuleReplacement(),\n          plugins.noEmitOnErrors(),\n\n          new FriendlyErrorsWebpackPlugin({\n            clearConsole: false,\n          }),\n        ])\n        break\n      case `build-javascript`: {\n        configPlugins = configPlugins.concat([\n          plugins.extractText(),\n          // Write out stats object mapping named dynamic imports (aka page\n          // components) to all their async chunks.\n          plugins.extractStats(),\n        ])\n        break\n      }\n    }\n\n    return configPlugins\n  }\n\n  function getDevtool() {\n    switch (stage) {\n      case `develop`:\n        return `cheap-module-source-map`\n      // use a normal `source-map` for the html phases since\n      // it gives better line and column numbers\n      case `develop-html`:\n      case `build-html`:\n      case `build-javascript`:\n        return `source-map`\n      default:\n        return false\n    }\n  }\n\n  function getMode() {\n    switch (stage) {\n      case `build-javascript`:\n        return `production`\n      case `develop`:\n      case `develop-html`:\n      case `build-html`:\n        return `development` // So we don't uglify the html bundle\n      default:\n        return `production`\n    }\n  }\n\n  function getModule(config) {\n    // Common config for every env.\n    // prettier-ignore\n    let configRules = [\n      rules.mjs(),\n      rules.js(),\n      rules.yaml(),\n      rules.fonts(),\n      rules.images(),\n      rules.media(),\n      rules.miscAssets(),\n    ]\n    if (store.getState().themes.themes) {\n      configRules = configRules.concat(\n        store.getState().themes.themes.map(theme => {\n          return {\n            test: /\\.jsx?$/,\n            include: theme.themeDir,\n            use: [loaders.js()],\n          }\n        })\n      )\n    }\n    switch (stage) {\n      case `develop`: {\n        // get schema to pass to eslint config and program for directory\n        const { schema, program } = store.getState()\n\n        // if no local eslint config, then add gatsby config\n        if (!hasLocalEslint(program.directory)) {\n          configRules = configRules.concat([rules.eslint(schema)])\n        }\n\n        configRules = configRules.concat([\n          {\n            oneOf: [rules.cssModules(), rules.css()],\n          },\n        ])\n\n        // RHL will patch React, replace React-DOM by React-🔥-DOM and work with fiber directly\n        // It's necessary to remove the warning in console (https://github.com/gatsbyjs/gatsby/issues/11934)\n        configRules.push({\n          include: /node_modules/,\n          test: /\\.jsx?$/,\n          use: {\n            loader: require.resolve(`./webpack-hmr-hooks-patch`),\n          },\n        })\n\n        break\n      }\n      case `build-html`:\n      case `develop-html`:\n        // We don't deal with CSS at all when building the HTML.\n        // The 'null' loader is used to prevent 'module not found' errors.\n        // On the other hand CSS modules loaders are necessary.\n\n        // prettier-ignore\n        configRules = configRules.concat([\n          {\n            oneOf: [\n              rules.cssModules(),\n              {\n                ...rules.css(),\n                use: [loaders.null()],\n              },\n            ],\n          },\n        ])\n        break\n\n      case `build-javascript`:\n        // We don't deal with CSS at all when building JavaScript but we still\n        // need to process the CSS so offline-plugin knows about the various\n        // assets referenced in your CSS.\n        //\n        // It's also necessary to process CSS Modules so your JS knows the\n        // classNames to use.\n        configRules = configRules.concat([\n          {\n            oneOf: [rules.cssModules(), rules.css()],\n          },\n        ])\n\n        break\n    }\n\n    return { rules: configRules }\n  }\n\n  function getResolve() {\n    const { program } = store.getState()\n    return {\n      // Use the program's extension list (generated via the\n      // 'resolvableExtensions' API hook).\n      extensions: [...program.extensions],\n      alias: {\n        gatsby$: directoryPath(path.join(`.cache`, `gatsby-browser-entry.js`)),\n        // Using directories for module resolution is mandatory because\n        // relative path imports are used sometimes\n        // See https://stackoverflow.com/a/49455609/6420957 for more details\n        \"@babel/runtime\": path.dirname(\n          require.resolve(`@babel/runtime/package.json`)\n        ),\n        \"core-js\": path.dirname(require.resolve(`core-js/package.json`)),\n        \"react-hot-loader\": path.dirname(\n          require.resolve(`react-hot-loader/package.json`)\n        ),\n        \"react-lifecycles-compat\": directoryPath(\n          `.cache/react-lifecycles-compat.js`\n        ),\n        \"create-react-context\": directoryPath(`.cache/create-react-context.js`),\n      },\n      plugins: [\n        // Those two folders are special and contain gatsby-generated files\n        // whose dependencies should be resolved through the `gatsby` package\n        PnpWebpackPlugin.bind(directoryPath(`.cache`), module),\n        PnpWebpackPlugin.bind(directoryPath(`public`), module),\n        // Transparently resolve packages via PnP when needed; noop otherwise\n        PnpWebpackPlugin,\n      ],\n    }\n  }\n\n  function getResolveLoader() {\n    const root = [path.resolve(directory, `node_modules`)]\n\n    const userLoaderDirectoryPath = path.resolve(directory, `loaders`)\n\n    try {\n      if (fs.statSync(userLoaderDirectoryPath).isDirectory()) {\n        root.push(userLoaderDirectoryPath)\n      }\n    } catch (err) {\n      debug(`Error resolving user loaders directory`, err)\n    }\n\n    return {\n      modules: [...root, path.join(__dirname, `../loaders`), `node_modules`],\n      // Bare loaders should always be loaded via the user dependencies (loaders\n      // configured via third-party like gatsby use require.resolve)\n      plugins: [PnpWebpackPlugin.moduleLoader(`${directory}/`)],\n    }\n  }\n\n  const config = {\n    // Context is the base directory for resolving the entry option.\n    context: directory,\n    entry: getEntry(),\n    output: getOutput(),\n\n    module: getModule(),\n    plugins: getPlugins(),\n\n    // Certain \"isomorphic\" packages have different entry points for browser\n    // and server (see\n    // https://github.com/defunctzombie/package-browser-field-spec); setting\n    // the target tells webpack which file to include, ie. browser vs main.\n    target: stage === `build-html` || stage === `develop-html` ? `node` : `web`,\n\n    devtool: getDevtool(),\n    // Turn off performance hints as we (for now) don't want to show the normal\n    // webpack output anywhere.\n    performance: {\n      hints: false,\n    },\n    mode: getMode(),\n\n    resolveLoader: getResolveLoader(),\n    resolve: getResolve(),\n\n    node: {\n      __filename: true,\n    },\n  }\n\n  if (stage === `build-javascript`) {\n    config.optimization = {\n      runtimeChunk: {\n        name: `webpack-runtime`,\n      },\n      splitChunks: {\n        name: false,\n        cacheGroups: {\n          // Only create one CSS file to avoid\n          // problems with code-split CSS loading in different orders\n          // causing inconsistent/non-determanistic styling\n          // See https://github.com/gatsbyjs/gatsby/issues/11072\n          styles: {\n            name: `styles`,\n            // This should cover all our types of CSS.\n            test: /\\.(css|scss|sass|less|styl)$/,\n            chunks: `all`,\n            enforce: true,\n          },\n        },\n      },\n      minimizer: [\n        // TODO: maybe this option should be noMinimize?\n        !program.noUglify && plugins.minifyJs(),\n        plugins.minifyCss(),\n      ].filter(Boolean),\n    }\n  }\n\n  if (stage === `build-html` || stage === `develop-html`) {\n    // Packages we want to externalize to save some build time\n    // https://github.com/gatsbyjs/gatsby/pull/14208#pullrequestreview-240178728\n    const externalList = [\n      `@reach/router/lib/history`,\n      `@reach/router`,\n      `common-tags`,\n      /^core-js\\//,\n      `crypto`,\n      `debug`,\n      `fs`,\n      `https`,\n      `http`,\n      `lodash`,\n      `path`,\n      `semver`,\n      /^lodash\\//,\n      `zlib`,\n    ]\n\n    // Packages we want to externalize because meant to be user-provided\n    const userExternalList = [\n      `es6-promise`,\n      `minimatch`,\n      `pify`,\n      `react-helmet`,\n      `react`,\n      /^react-dom\\//,\n    ]\n\n    const checkItem = (item, request) => {\n      if (typeof item === `string` && item === request) {\n        return true\n      } else if (item instanceof RegExp && item.test(request)) {\n        return true\n      }\n      return false\n    }\n\n    const isExternal = request => {\n      if (externalList.some(item => checkItem(item, request))) {\n        return `umd ${require.resolve(request)}`\n      }\n      if (userExternalList.some(item => checkItem(item, request))) {\n        return `umd ${request}`\n      }\n      return null\n    }\n\n    config.externals = [\n      function(context, request, callback) {\n        const external = isExternal(request)\n        if (external !== null) {\n          callback(null, external)\n        } else {\n          callback()\n        }\n      },\n    ]\n  }\n\n  store.dispatch(actions.replaceWebpackConfig(config))\n  const getConfig = () => store.getState().webpack\n\n  await apiRunnerNode(`onCreateWebpackConfig`, {\n    getConfig,\n    stage,\n    rules,\n    loaders,\n    plugins,\n  })\n\n  return getConfig()\n}\n"],"file":"webpack.config.js"}
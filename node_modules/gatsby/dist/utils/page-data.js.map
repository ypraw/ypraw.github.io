{"version":3,"sources":["../../src/utils/page-data.js"],"names":["fs","require","path","Promise","chunk","getFilePath","publicDir","pagePath","fixedPagePath","join","read","filePath","rawPageData","readFile","JSON","parse","write","page","result","webpackCompilationHash","body","componentChunkName","outputFile","stringify","updateCompilationHashes","workerPool","pagePaths","segments","map","segment","module","exports"],"mappings":";;;;;;AAAA,MAAMA,EAAE,GAAGC,OAAO,CAAE,UAAF,CAAlB;;AACA,MAAMC,IAAI,GAAGD,OAAO,CAAE,MAAF,CAApB;;AACA,MAAME,OAAO,GAAGF,OAAO,CAAE,UAAF,CAAvB;;iBACkBA,OAAO,CAAE,QAAF,C;MAAjBG,K,YAAAA,K;;AAER,MAAMC,WAAW,GAAG,CAAC;AAAEC,EAAAA;AAAF,CAAD,EAAgBC,QAAhB,KAA6B;AAC/C,QAAMC,aAAa,GAAGD,QAAQ,KAAM,GAAd,GAAoB,OAApB,GAA6BA,QAAnD;AACA,SAAOL,IAAI,CAACO,IAAL,CAAUH,SAAV,EAAsB,WAAtB,EAAkCE,aAAlC,EAAkD,gBAAlD,CAAP;AACD,CAHD;;AAIA,MAAME,IAAI;AAAA;AAAA;AAAA,6CAAG,WAAO;AAAEJ,IAAAA;AAAF,GAAP,EAAsBC,QAAtB,EAAmC;AAC9C,UAAMI,QAAQ,GAAGN,WAAW,CAAC;AAAEC,MAAAA;AAAF,KAAD,EAAgBC,QAAhB,CAA5B;AACA,UAAMK,WAAW,SAASZ,EAAE,CAACa,QAAH,CAAYF,QAAZ,EAAuB,OAAvB,CAA1B;AACA,WAAOG,IAAI,CAACC,KAAL,CAAWH,WAAX,CAAP;AACD,GAJS;;AAAA,kBAAJF,IAAI;AAAA;AAAA;AAAA,GAAV;;AAMA,MAAMM,KAAK;AAAA;AAAA;AAAA,8CAAG,WAAO;AAAEV,IAAAA;AAAF,GAAP,EAAsBW,IAAtB,EAA4BC,MAA5B,EAAoCC,sBAApC,EAA+D;AAC3E,UAAMR,QAAQ,GAAGN,WAAW,CAAC;AAAEC,MAAAA;AAAF,KAAD,EAAgBW,IAAI,CAACf,IAArB,CAA5B;AACA,UAAMkB,IAAI,GAAG;AACXC,MAAAA,kBAAkB,EAAEJ,IAAI,CAACI,kBADd;AAEXnB,MAAAA,IAAI,EAAEe,IAAI,CAACf,IAFA;AAGXiB,MAAAA,sBAHW;AAIXD,MAAAA;AAJW,KAAb;AAMA,UAAMlB,EAAE,CAACsB,UAAH,CAAcX,QAAd,EAAwBG,IAAI,CAACS,SAAL,CAAeH,IAAf,CAAxB,CAAN;AACD,GATU;;AAAA,kBAALJ,KAAK;AAAA;AAAA;AAAA,GAAX;;AAWA,MAAMQ,uBAAuB,GAAG,CAC9B;AAAElB,EAAAA,SAAF;AAAamB,EAAAA;AAAb,CAD8B,EAE9BC,SAF8B,EAG9BP,sBAH8B,KAI3B;AACH,QAAMQ,QAAQ,GAAGvB,KAAK,CAACsB,SAAD,EAAY,EAAZ,CAAtB;AACA,SAAOvB,OAAO,CAACyB,GAAR,CAAYD,QAAZ,EAAsBE,OAAO,IAClCJ,UAAU,CAACD,uBAAX,CACE;AAAElB,IAAAA;AAAF,GADF,EAEEuB,OAFF,EAGEV,sBAHF,CADK,CAAP;AAOD,CAbD;;AAeAW,MAAM,CAACC,OAAP,GAAiB;AACfrB,EAAAA,IADe;AAEfM,EAAAA,KAFe;AAGfQ,EAAAA;AAHe,CAAjB","sourcesContent":["const fs = require(`fs-extra`)\nconst path = require(`path`)\nconst Promise = require(`bluebird`)\nconst { chunk } = require(`lodash`)\n\nconst getFilePath = ({ publicDir }, pagePath) => {\n  const fixedPagePath = pagePath === `/` ? `index` : pagePath\n  return path.join(publicDir, `page-data`, fixedPagePath, `page-data.json`)\n}\nconst read = async ({ publicDir }, pagePath) => {\n  const filePath = getFilePath({ publicDir }, pagePath)\n  const rawPageData = await fs.readFile(filePath, `utf-8`)\n  return JSON.parse(rawPageData)\n}\n\nconst write = async ({ publicDir }, page, result, webpackCompilationHash) => {\n  const filePath = getFilePath({ publicDir }, page.path)\n  const body = {\n    componentChunkName: page.componentChunkName,\n    path: page.path,\n    webpackCompilationHash,\n    result,\n  }\n  await fs.outputFile(filePath, JSON.stringify(body))\n}\n\nconst updateCompilationHashes = (\n  { publicDir, workerPool },\n  pagePaths,\n  webpackCompilationHash\n) => {\n  const segments = chunk(pagePaths, 50)\n  return Promise.map(segments, segment =>\n    workerPool.updateCompilationHashes(\n      { publicDir },\n      segment,\n      webpackCompilationHash\n    )\n  )\n}\n\nmodule.exports = {\n  read,\n  write,\n  updateCompilationHashes,\n}\n"],"file":"page-data.js"}
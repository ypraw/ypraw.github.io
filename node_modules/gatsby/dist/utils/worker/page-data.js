"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

const fs = require(`fs-extra`);

const path = require(`path`);

const Promise = require(`bluebird`);

const getFilePath = ({
  publicDir
}, pagePath) => {
  const fixedPagePath = pagePath === `/` ? `index` : pagePath;
  return path.join(publicDir, `page-data`, fixedPagePath, `page-data.json`);
};

const updateJsonFileField =
/*#__PURE__*/
function () {
  var _ref = (0, _asyncToGenerator2.default)(function* (filename, fieldname, value) {
    const object = JSON.parse((yield fs.readFile(filename, `utf-8`)));
    object[fieldname] = value;
    yield fs.outputFile(filename, JSON.stringify(object), `utf-8`);
  });

  return function updateJsonFileField(_x, _x2, _x3) {
    return _ref.apply(this, arguments);
  };
}();

const updateCompilationHashes = ({
  publicDir
}, pagePaths, webpackCompilationHash) => Promise.map(pagePaths, pagePath => updateJsonFileField(getFilePath({
  publicDir
}, pagePath), `webpackCompilationHash`, webpackCompilationHash));

module.exports = {
  getFilePath,
  updateCompilationHashes
};
//# sourceMappingURL=page-data.js.map
{"version":3,"sources":["../../../src/utils/worker/cpu-core-count.js"],"names":["cpuCoreCount","useEnvVar","coreCount","require","process","env","GATSBY_CPU_COUNT","coreCountArg","Number","cpus","length","Error","err","console","error","module","exports"],"mappings":";;AAAA;;;;;AAMA,MAAMA,YAAY,GAAG,CAACC,SAAS,GAAG,IAAb,KAAsB;AACzC,MAAI;AACF,QAAIC,SAAS,GAAGC,OAAO,CAAE,sBAAF,CAAP,IAAmC,CAAnD;;AAEA,QAAI,CAACF,SAAL,EAAgB;AACd;AACA;AACA,aAAOC,SAAP;AACD;;AAED,QAAI,OAAOE,OAAO,CAACC,GAAR,CAAYC,gBAAnB,KAAyC,WAA7C,EAAyD;AACvD,YAAMC,YAAY,GAChBC,MAAM,CAACJ,OAAO,CAACC,GAAR,CAAYC,gBAAb,CAAN,IAAwCF,OAAO,CAACC,GAAR,CAAYC,gBADtD;;AAGA,cAAQ,OAAOC,YAAf;AACE,aAAM,QAAN;AACE;AAEA;AACA;AACA,cAAIA,YAAY,KAAM,eAAtB,EAAsC;AACpCL,YAAAA,SAAS,GAAGC,OAAO,CAAE,IAAF,CAAP,CAAcM,IAAd,GAAqBC,MAAjC;;AAEA,gBAAI,OAAOR,SAAP,KAAsB,QAA1B,EAAmC;AACjC,oBAAM,IAAIS,KAAJ,CACH,oHADG,CAAN;AAGD;AACF;;AACD;;AAEF,aAAM,QAAN;AACE;AACAT,UAAAA,SAAS,GAAGK,YAAZ;AACA;;AAEF;AACE;AAvBJ;AAyBD;;AAED,WAAOL,SAAP;AACD,GAzCD,CAyCE,OAAOU,GAAP,EAAY;AACZC,IAAAA,OAAO,CAACC,KAAR,CAAcF,GAAd;AACA,UAAM,IAAID,KAAJ,CAAW,2DAAX,CAAN;AACD;AACF,CA9CD;;AAgDAI,MAAM,CAACC,OAAP,GAAiBhB,YAAjB","sourcesContent":["/**\n * Calculate CPU core count\n * @param {boolean} [useEnvVar=false] Use the 'GATSBY_CPU_COUNT' env var to calculate the requested type of CPU cores\n * @returns {number} Count of the requested type of CPU cores. Defaults to number of physical cores or 1\n */\n\nconst cpuCoreCount = (useEnvVar = true) => {\n  try {\n    let coreCount = require(`./physical-cpu-count`) || 1\n\n    if (!useEnvVar) {\n      // Return the physical CPU count,\n      // or default to 1 if we can't detect\n      return coreCount\n    }\n\n    if (typeof process.env.GATSBY_CPU_COUNT !== `undefined`) {\n      const coreCountArg =\n        Number(process.env.GATSBY_CPU_COUNT) || process.env.GATSBY_CPU_COUNT\n\n      switch (typeof coreCountArg) {\n        case `string`:\n          // Leave at Default CPU count if coreCountArg === `physical_cores`\n\n          // CPU count === logical CPU count\n          // throw error if we have a problem counting logical cores\n          if (coreCountArg === `logical_cores`) {\n            coreCount = require(`os`).cpus().length\n\n            if (typeof coreCount !== `number`) {\n              throw new Error(\n                `process.env.GATSBY_CPU_COUNT is set to 'logical_cores' but there was a problem finding the number of logical cores`\n              )\n            }\n          }\n          break\n\n        case `number`:\n          // CPU count === passed in count\n          coreCount = coreCountArg\n          break\n\n        default:\n          break\n      }\n    }\n\n    return coreCount\n  } catch (err) {\n    console.error(err)\n    throw new Error(`There has been a problem counting the number of CPU cores`)\n  }\n}\n\nmodule.exports = cpuCoreCount\n"],"file":"cpu-core-count.js"}
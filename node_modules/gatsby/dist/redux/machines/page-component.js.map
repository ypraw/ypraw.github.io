{"version":3,"sources":["../../../src/redux/machines/page-component.js"],"names":["require","Machine","assign","actions","module","exports","id","initial","context","isInBootstrap","componentPath","query","on","BOOTSTRAP_FINISHED","DELETE_PAGE","NEW_PAGE_CREATED","QUERY_EXTRACTION_GRAPHQL_ERROR","QUERY_EXTRACTION_BABEL_ERROR","states","inactive","target","cond","inactiveWhileBootstrapping","QUERY_CHANGED","queryExtractionGraphQLError","QUERY_DID_NOT_CHANGE","queryExtractionBabelError","QUERY_EXTRACTION_BABEL_SUCCESS","runningPageQueries","onEntry","QUERIES_COMPLETE","idle","guards","isBootstrapping","isNotBootstrapping","runPageComponentQueries","event","queryUtil","setTimeout","enqueueExtractedPageComponent","setQuery","ctx","setPage","pages","path","enqueueExtractedQueryId","runQueuedQueries","concat","deletePage","filter","p","page","setBootstrapFinished"],"mappings":"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","sourcesContent":["const {\n  Machine,\n  actions: { assign },\n} = require(`xstate`)\n\nmodule.exports = Machine(\n  {\n    id: `pageComponents`,\n    initial: `inactive`,\n    context: {\n      isInBootstrap: true,\n      componentPath: ``,\n      query: ``,\n    },\n    on: {\n      BOOTSTRAP_FINISHED: {\n        actions: `setBootstrapFinished`,\n      },\n      DELETE_PAGE: {\n        actions: `deletePage`,\n      },\n      NEW_PAGE_CREATED: {\n        actions: `setPage`,\n      },\n      QUERY_EXTRACTION_GRAPHQL_ERROR: `queryExtractionGraphQLError`,\n      QUERY_EXTRACTION_BABEL_ERROR: `queryExtractionBabelError`,\n    },\n    states: {\n      inactive: {\n        on: {\n          // Transient transition\n          // Will transition to either 'inactiveWhileBootstrapping' or idle\n          // immediately upon entering 'inactive' state if the condition is met.\n          \"\": [\n            { target: `inactiveWhileBootstrapping`, cond: `isBootstrapping` },\n            { target: `idle`, cond: `isNotBootstrapping` },\n          ],\n        },\n      },\n      inactiveWhileBootstrapping: {\n        on: {\n          BOOTSTRAP_FINISHED: {\n            target: `idle`,\n            actions: `setBootstrapFinished`,\n          },\n          QUERY_CHANGED: `runningPageQueries`,\n        },\n      },\n      queryExtractionGraphQLError: {\n        on: {\n          QUERY_DID_NOT_CHANGE: `idle`,\n          QUERY_CHANGED: `runningPageQueries`,\n        },\n      },\n      queryExtractionBabelError: {\n        on: {\n          QUERY_EXTRACTION_BABEL_SUCCESS: `idle`,\n        },\n      },\n      runningPageQueries: {\n        onEntry: [`setQuery`, `runPageComponentQueries`],\n        on: {\n          QUERIES_COMPLETE: `idle`,\n        },\n      },\n      idle: {\n        on: {\n          QUERY_CHANGED: `runningPageQueries`,\n        },\n      },\n    },\n  },\n  {\n    guards: {\n      isBootstrapping: context => context.isInBootstrap,\n      isNotBootstrapping: context => !context.isInBootstrap,\n    },\n    actions: {\n      runPageComponentQueries: (context, event) => {\n        const queryUtil = require(`../../query`)\n        // Wait a bit as calling this function immediately triggers\n        // an Action call which Redux squawks about.\n        setTimeout(() => {\n          queryUtil.enqueueExtractedPageComponent(context.componentPath)\n        }, 0)\n      },\n      setQuery: assign({\n        query: (ctx, event) => {\n          if (typeof event.query !== `undefined` || event.query !== null) {\n            return event.query\n          } else {\n            return ctx.query\n          }\n        },\n      }),\n      setPage: assign({\n        pages: (ctx, event) => {\n          if (event.path) {\n            const queryUtil = require(`../../query`)\n            // Wait a bit as calling this function immediately triggers\n            // an Action call which Redux squawks about.\n            setTimeout(() => {\n              if (!ctx.isInBootstrap) {\n                queryUtil.enqueueExtractedQueryId(event.path)\n                queryUtil.runQueuedQueries(event.path)\n              }\n            }, 0)\n\n            return ctx.pages.concat(event.path)\n          } else {\n            return ctx.pages\n          }\n        },\n      }),\n      deletePage: assign({\n        pages: (ctx, event) => ctx.pages.filter(p => p !== event.page.path),\n      }),\n      setBootstrapFinished: assign({\n        isInBootstrap: false,\n      }),\n    },\n  }\n)\n"],"file":"page-component.js"}